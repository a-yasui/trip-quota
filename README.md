# TripQuota

TripQuota は複数人での旅行計画を共有・管理するためのウェブアプリケーションです。旅客機チケット、バスや電車のチケット、宿泊先ホテル、eSim変更に伴う電話番号の変更などを共有し、旅行の計画から実行、精算までをサポートします。

## 目次

- [利用シナリオ](#利用シナリオ)
- [用語集](#用語集)
- [主要機能](#主要機能)
  - [旅行計画](#旅行計画)
  - [グループ管理](#グループ管理)
  - [旅程入力](#旅程入力)
  - [割り勘管理](#割り勘管理)
  - [通知機能](#通知機能)
  - [アカウント管理](#アカウント管理)
- [技術スタック](#技術スタック)
- [プロジェクト構造](#プロジェクト構造)
- [開発ガイドライン](#開発ガイドライン)

## 利用シナリオ

以下は、TripQuotaの典型的な利用シナリオです：

Aさん、Bさん、Cさんの三人で日本から韓国のソウルへ旅行する場合：

1. **計画段階**：
   - Aさんがチケット、Bさんが宿泊先、Cさんが観光地を担当
   - Aさんが TripQuota にアカウントを作成し、旅行計画（2024年10月10日〜13日）を作成
   - BさんとCさんをメールで招待

2. **情報共有**：
   - Aさんが飛行機の便、出発・到着時刻を登録
   - Bさんが宿泊ホテル情報（10日〜11日、11日〜12日の別々のホテル）を登録
   - Cさんが観光地情報をGoogleMapやWebサイト、雑誌から共有

3. **旅行中**：
   - 韓国到着後の食事でAさんがカード支払い
   - 二日目の朝食はCさんが現金で支払い
   - TripQuotaに支払い情報（ウォン）を記録

4. **精算**：
   - 旅行終了後、未記入の支払いがないか通知
   - 各自の支払い状況を確認し、日本円での精算額を計算

## 用語集

| 用語 | 定義 |
|------|------|
| サイトの登録 | メールアドレス・OAuthなど外部サイトログインで、サイトにアカウントを作成すること |
| アカウント | サイトに登録したユーザーデータ |
| メンバー | 旅行する人（アカウント所有の有無を問わない） |
| グループ | メンバーの集まり |
| コアグループ | 主となるグループ（旅行する全メンバーが所属） |
| 班グループ | コアグループから一部のメンバーが集まって別行動するときのグループ |
| 時刻 | 特に明記がない限り現地のタイムゾーンを使用 |
| 出発日 | 旅行の開始日（タイムゾーンは変更可能） |
| 帰宅日 | 旅行の最終日（タイムゾーンは変更可能） |

## 主要機能

### 旅行計画

- グループと旅程の情報入力で旅行計画を作成
- 出発日に帰宅日が未記入の場合、計画破棄または帰宅日入力を要求
- 日程重複するメンバーへのアラート表示
- メンバー不在時の計画データ破棄
- 削除権限の管理（基本は作成者、委譲可能）

### グループ管理

- コアグループ：全メンバーが所属する主グループ
- 班グループ：一部メンバーの別行動用グループ
- 未登録メンバーの代理入力機能

### 旅程入力

- 出発日から帰宅日までの期間管理（最長120日）
- 移動手段情報の登録（徒歩・バイク・車・フェリー・バス・飛行機）
- 宿泊先情報の登録
- 飛行機利用時は航空会社、便名、出発・到着時刻の入力が必須

### 割り勘管理

- 支払い情報の記録（金額、通貨、支払者、対象者）
- 旅行終了後の精算計算

### 通知機能

- メンバー招待通知
- 情報更新通知
- 未記入支払い確認通知

### アカウント管理

- メールアドレス・パスワードによる登録
- OAuth認証による外部サイトアカウントでの登録
- ログイン機能

## 技術スタック

- PHP 8.3
- Laravel 11

## プロジェクト構造

```
.clinerules-dev # プロンプト
app/*           # Laravel Application
TripQuota/*     # namespace が TripQuota\ で始まる各種機能
```

## 開発ガイドライン

### ドメイン設計

- 各機能はドメインとして実装
- ドメインの namespace は `TripQuota\` で始まり、機能名が続く
- ドメインの機能を使うには `<ドメイン名>Service` クラスを使用
- 各ドメインは機能内で完結し、他の機能のクラスを使用しない（`<ドメイン名>Service` クラスを除く）

### テスト方法

- Laravel Eloquent は Repository パターンで抽象化
- Service は Repository 経由でデータをやり取り
- テストには Dummy Repository 実装を使用

### Gitワークフロー

コミットとプルリクエストの作成に関するベストプラクティスについては、詳細なガイドラインが用意されています。

### 厳守事項

1. **ファイル `.env` は決して読んではいけない**
2. ファイルの変更が必要な時は、ユーザに問い合わせをする
