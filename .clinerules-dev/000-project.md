# このプロジェクト

このプロジェクトは `TripQuota` という名前のサイトを作る。サイトは複数人で旅行をする時に、旅客機チケット、バスや電車のチケット、宿泊先ホテル、eSim 変更に伴う電話番号の変更などを共有する。

## 利用想定

ここに利用シーンを仮定してサイト利用の流れを把握する。


### 利用シーン１　短期旅行

Aさん、Bさん、Cさんの三人で、日本から韓国のソウルに行く事になった。

まず役割分担としてAさんがチケット、Bさんが宿泊先、Cさんがそれぞれの観光地を探す事にした。それぞれの事が別々なのでチャットだけでは難しく、タイムラインとして表示させるため `TripQuota` を使う事にした。期間は 2024年10月10日〜2024年10月13日の三日間としている。AさんはBさんとCさんのメールアドレスを知っているので、AさんはTripQuotaにアカウントを作成し、旅行計画を作成した後に、BさんCさんを誘った。まず、旅行計画には出発日と帰国日が記入する。今回は経由地はない。

AさんはBさんとCさんに、自身が乗る飛行機の便、出発時刻と到着時刻（現地）を連絡するため、サイトに自身が搭乗予定として登録をする。BさんとCさんにはメールで通知され、同様の便を探し各自でチケット購入をした。
Bさんはホテルも一緒がいいだろうとなり、一つのホテルで三人分の二泊を登録をしようとした。しかし、一つのホテルは一泊しか取れず、結局、三人は二泊するホテルのうち10日〜11日宿泊のホテルと11日〜12日の宿泊のホテルが別々になり、Bさんは三人のホテルが初日、二日目のそれぞれを入力した。
Cさんはメジャな観光地等をGoogleMapやwebサイト、雑誌の切り抜き、または打ち込みをして共有する事にした。

当日、韓国に着いた時、三人で食事をした。その時、Aさんが合算をして支払いをした。この時はカードで支払いをした。二日目、朝食はAさんとCさんの二人が外でして、Cさんが現金で支払いを二人分した。`TripQuota`には、二日目の朝にAさんとCさんの朝食代をいくら払ったという割り勘ログを付けた。TripQuota には won でログ付けされ、後にAさんは円でCさんに支払いをする。

最終日の翌日になって、AさんBさんCさん宛に、支払いの未記入がないか通知され、割り勘の未記入分を記入し、おのおのが誰に対して日本円でどれだけ払えばいいか計算されて送られる。

### 利用シーン2 社員旅行

大阪にある会社ABCは社員10人で、社員旅行として沖縄に行く事にした。旅程として2024年10月10日に伊丹空港を出発、2024年10月13日に帰宅する。役割として、社員Aさんが10人分のチケットを手配する。ツアーパックで宿泊先までおさえた。12日は現地の社員の3人と会食する事になっている。

### 利用シーン3 他社合流を含めた旅行

大阪にある会社ABCと東京にある会社BDBは、旅行先の北海道で一時合流することになっている。

会社ABCは2024年12月13日に北海道入りをして、2024年12月24日に帰宅する。東京の会社BDBは2024年1213に青森に行き，2024年12月20日に北海道、2025年01月03日に新潟、2025年01月01日に東京に帰宅する。

# サイトの特徴

グループ内で旅行に関する共有をするのが目的である。

## 辞書

いくつかサイト内の表記揺れを防ぐため、言葉を決めておく。

| 言葉 | 英語 | 意味 |
| :----- | :----- | :----- |
| サイトの登録 | register | サイトの登録は、メールアドレス・OAuthなど外部サイトログインで、サイトにアカウントを作成する事である |
| ログインアカウント | LoginAccount | ログインするための情報。有効なメールアドレスが必須 |
| アカウント | Account |サイトに登録をしたデータの事。|
| メンバー | Member | 旅行する人の事。アカウントがあれば、無い場合もある。|
| 旅行計画 | Trip Quote | 旅行の全貌の事。 |
| グループ | Group | メンバーの集まり。|
| コアグループ | Core Group | 主となるグループ。旅行する全メンバーが集まっている |
| 班グループ | Branch Group | コアグループの中から、一部のメンバーが集まって行動する時に使うグループ |
| 区別用名前 | System Branch Group Key | 別旅行計画等の班グループを招待するために、招待する時に使う名前 |
| 時刻 | Date | 時間の事。明記がない限り現地のタイムゾーンを使う。メンバーが日本在住の場合は、出発時は日本時刻になり、旅行先が韓国の時は、到着時間は韓国時間になる |
| 出発日 | departure date | 旅行の開始日である。この時刻は初めに旅行計画をたてたメンバーの国のタイムゾーンに依存するが、入力時の国のタイムゾーンとなり、後にタイムゾーンは変更可能 |
| 帰宅日 | Return Date | 旅行の最終日である。出発日同様、タイムゾーンの変更は可能である|
| サイト管理者 | Admin | TripQuota で何らかのトラブルがあった時に管理するための管理者。ログインアカウントとは別である。 |

# サイトの機能

サイトの実装する機能を書く。

- [機能] と書いている項目はユーザ側に関連する機能である
- [管理機能] と書いている項目は、サイト管理者が

## [機能] ログインアカウント

- メールアドレスとパスワードの組み合わせでログインする。
- メールアドレスはサイト内でユニークとする
- OAuth で登録する時、既にメールアドレスが存在する時は、そのメールアドレスとパスワードでログインをうながす。
- OAuth で登録する時、メールアドレスが未登録のときは、そのメールアドレスでログインアカウントを作成する。その際パスワードログインはできない事とする。
- ユーザのログイン管理画面で、OAuthの登録を済ましている時は、そのままログインできる。
- ログイン情報を管理する画面では、メールアドレス、パスワード、OAuthの連携・連携解除ができる。

## [機能] アカウント機能

- アカウントの登録情報、過去に参加した旅行計画の一覧などを見る事ができる。この機能は他アカウントの情報は見れない。
- アカウントはユニークになる「account名」を持っており、その制限は '^[a-zA-Z][\w\-_]{3,}$' という物である。ただし、アカウントのユニークは、英語の大文字小文字を問わない。例えば ABC と abc は同一アカウントとする。
- アカウントは他人からもわかるように、サムネイル画像を登録する機能がある。
- 一つのログインアカウントに対して、アカウントは複数持てる。それは、旅行計画に応じてアカウントを変更できるようにするためである。
- 参加している旅行計画で、別アカウントに置き換える機能がある。例えばABCというアカウントで参加しているが、ABCDE という別アカウントで参加し直したい時は、account保持者なら可能とする。その際、旅行計画に参加している他アカウントにその事の通知が飛ぶ。

## [機能] 旅行計画

メンバー数は問わず、１回の旅行の計画を作る。
旅行計画にはDB内で唯一の名前を付ける必要がある。それはシステム内で自動的に決まる物で、UUID のランダム値である。

- 一つのアカウントで旅行計画を最低一つ持てる。
- 旅行計画には、グループと旅程の最低二つが必須になる。それぞれの最低限の情報を入力したら旅行計画は作成できる。
- 旅行計画で出発日を迎えても、帰宅日が未記入の時は、旅行計画を破棄するか、帰宅日を入力するかのどちらか選択しないと使えないようにする。
- 別の旅行計画が日程が重なっているメンバーがいる時、そのメンバーはアラートが表示される。
- 旅行計画からメンバーがいなくなったら、旅行計画のデータは全て破棄する。
- 旅行計画は削除権限を持ったメンバーがおり、基本は作成者とする。
    - 削除権限は他のメンバーに委譲する事ができる。
    - 削除は、出発日の前日の0時までできる。その日以降は終了日が未入力の時だけ削除可能である。
    - 削除した時に参加していたアカウントに通知は飛ぶ。
- 旅行計画から作成者が退出する時は、削除権限がない時である。

## [機能] グループ

- 主となる旅行のメンバーを招待する機能である。
- 旅行計画を作成したメンバーが最小単位である。
- 必要に応じて、`TripQuota`に登録していないメンバーの代筆できる機能がある。
- グループへの参加は招待のみである。account保持者が既存のグループへ参加するには、招待を受ける必要がある。
- グループには名前が付けられる。
    - コアグループは登録時に登録した名前が使われる。
    - 班グループは後から名前の変更が可能だが、区別用名前は変更不可である。

### [機能]旅行計画とグループの関連

- 他の旅行計画の班グループと合流する事がある。それは互いに班グループの単位のみ可能である。
- 他の旅行計画の班グループと合流するには、招待を受ける必要がある。
- 参加された班グループは、合流した班グループのメンバーと計画だけ見る事ができ、変更はできないとする。
- 他の旅行計画の班グループと合流は、有効な旅行計画の班グループのみ可能である。
- 他の旅行計画の班グループと合流方法は、

### [機能] グループの種類とメンバーの関連性

グループは、コアグループとブランチグループに分かれる。

- コアグループ : メンバー全員が集まっているグループ。誰がいつからいつまで、どこに宿泊している等といった情報が見れる。
- 班グループ : コアグループから一部のメンバーが集まって別行動するときのグループ。他の旅行計画の班グループと合流は可能とする。

### [機能] グループ参加のプロセス

1. グループにいるメンバーが、account名を教えてもらい、検索をして招待ボタンを押す。
2. 招待を受けたメンバーはログインをして、参加承認のボタンを押して、旅行計画に参加をする。

### [機能] 班グループの作成プロセス

1. コアグループにいるメンバーが、「班グループ」名を入力して作成する。
2. コアグループにいる別メンバーを選択して、参加ボタンを押す。

### [機能] 班グループでできる事

- 

## [機能] 旅程入力

- 旅行計画の出発日から帰宅日までの期間の事である。
    - 出発日だけが決まっている場合があり、最終日は未記入でも旅行計画は作成できる。
    - 未記入のまま出発日になった時、旅行計画は停止し、最終日の入力が必須となる。
    - 出発日から帰宅日の最長期間は120日までとする。
    - これはメンバーごとに違うが、サイトにまだアカウント作成してない等といった状況に対応するため、他のメンバーの情報を書く事もある。
    - 他のメンバー情報は「名前」のみである。
    - 飛行機やフェリーなどは、登録者以外のメンバーを選択して、移動手段を入力する事ができる。
- 入力に必須なのは、移動手段（徒歩・バイク・車・フェリー・バス・飛行機）の情報と、宿泊先のホテル名である。
    - 移動手段が飛行機の場合は航空会社、便名、出発時刻、到着時刻の入力が必須になる。

## [機能] メンバー管理

* 追加、退出は全メンバーできる

## [機能] 割り勘入力

必須入力

* いつ支払いをしたか
* 誰が支払いをしたか
* 全員で誰がいたか
* どの通貨で支払いをしたか
* 金額はいくらか

割り勘入力は確定するまで参加、不参加ができる。

## [機能] 通知機能

通知するタイミング。これ以外にも後々増える事を考慮する

1. 旅行計画のメンバーに招待
2. 割り勘メンバーに参加

## [機能] アカウント登録

登録方法はいくつかある。

1. メールアドレス・パスワード
2. OAuth で別サイトアカウントでの登録

### [管理機能] ログイン時

- ログイン時にIPアドレスを保持する。

### 追加・変更が可能

- メールアドレス
- パスワード

## [機能] ログイン

ログインをしないと、旅行計画の作成などといった各機能が使えないとする。

## [機能] 履歴機能

- 過去の旅行計画を見る事ができる。後から割り勘参加等をするため。
- 各種変更履歴を保持する。
- 旅行計画が「誰」に作成された
- メンバーに招待された

